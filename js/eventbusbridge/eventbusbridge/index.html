<html>
<head>
  <title></title>
  <script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
  <script src="vertxbus.js"></script>
</head>
<body>
  <script>

    var  eb = new vertx.EventBus("http://localhost:8080/eventbus");

    eb.onopen = function() {
        var status = document.getElementById("status");
        status.innerHTML = "EVENTBUS CONNECTED";
        status.style.color="lime"
    };

    eb.onclose = function() {
        var status = document.getElementById("status");
        status.innerHTML = "EVENTBUS DISCONNECTED";
        status.style.color = "red";
    };

    function search(tag){
      eb.send('webclient_address', tag, function(msg, replyTo) {
        var data = JSON.parse(msg)
        var items = data.items;
        var html = '<h1>Results</h1>';
        
        for (var i = 0; i < items.length; i++) {
          html += '<h3>' + items[i].title + '</h3>';
          html += '<a href="' + items[i].link + '"><img src="' + items[i].media.m + '" /></a>';
          html += items[i].description;
        }
        document.getElementById("content").innerHTML = html ;

        });
    }
</script>

<div style="position:fixed;left:0;top:0;background-color:grey;width:100%;padding:1em;z-index:50">
  <form onsubmit="return false;">
    <input type="text" name="message" value="Kittenz"/>
    <input type="button" value="Search on eventbus" onclick="search(this.form.message.value)"/>
    <span id="status" style="position:absolute;right:1em;top:0;font-size:2em;font-family:sans-serif;color:red">EVENT BUS DISCONNECTED</span>
  </form>
</div>

<div id="content" style="position:absolute;padding:1em;margin-top:5em">Search something! <div>

</body>
</html>
